-- Require sysdba
Create PUBLIC DATABASE LINK ARCHIVE_DBLINK CONNECT TO &src_user identified by &src_password using '(DESCRIPTION =(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=&src_host)(PORT=&src_port)))(CONNECT_DATA=(sid=&src_database)) )  ' ;



--execute MovEDocdb
DECLARE
  DBSOURCECABINET VARCHAR2(200);
  DBSRCLINKNAME VARCHAR2(200);
  DBMOVEFOLDERINDEX NUMBER;
  IN_DBMOVEDOCFLAG CHAR(200);
  IN_DBGENERATEINDEX CHAR(200);
  DBNEWFOLDERINDEX NUMBER;
  DBSTATUS NUMBER;
BEGIN
  DBSOURCECABINET := 'pora7';
  DBSRCLINKNAME := 'ARCHIVE_DBLINK';
  DBMOVEFOLDERINDEX := 110;
  IN_DBMOVEDOCFLAG := NULL;
  IN_DBGENERATEINDEX := NULL;

  SAVEPOINT ss;
  MOVEDOCDB(
    DBSOURCECABINET => DBSOURCECABINET,
    DBSRCLINKNAME => DBSRCLINKNAME,
    DBMOVEFOLDERINDEX => DBMOVEFOLDERINDEX,
    IN_DBMOVEDOCFLAG => IN_DBMOVEDOCFLAG,
    IN_DBGENERATEINDEX => IN_DBGENERATEINDEX,
    DBNEWFOLDERINDEX => DBNEWFOLDERINDEX,
    DBSTATUS => DBSTATUS
  );
  
  IF DBSTATUS = 0 
  THEN
	 COMMIT WORK;
  END IF;
 
  IF DBSTATUS <> 0 
  THEN
	ROLLBACK TO ss;
  END IF;
  
  DBMS_OUTPUT.PUT_LINE('DBNEWFOLDERINDEX = ' || DBNEWFOLDERINDEX);
  DBMS_OUTPUT.PUT_LINE('DBSTATUS = ' || DBSTATUS);
  
  EXCEPTION
  WHEN OTHERS THEN
	ROLLBACK TO ss;  
END;
